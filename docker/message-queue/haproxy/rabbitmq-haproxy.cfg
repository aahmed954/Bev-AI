global
    log stdout local0
    maxconn 4096
    daemon

defaults
    log     global
    mode    tcp
    option  tcplog
    option  dontlognull
    timeout connect 5000ms
    timeout client  30000ms
    timeout server  30000ms

# RabbitMQ AMQP Load Balancing
frontend rabbitmq_amqp_front
    bind *:5670
    default_backend rabbitmq_amqp_back

backend rabbitmq_amqp_back
    balance roundrobin
    server rabbitmq1 rabbitmq1:5672 check inter 5000 rise 2 fall 3
    server rabbitmq2 rabbitmq2:5672 check inter 5000 rise 2 fall 3
    server rabbitmq3 rabbitmq3:5672 check inter 5000 rise 2 fall 3

# RabbitMQ Management UI Load Balancing
frontend rabbitmq_mgmt_front
    bind *:15670
    default_backend rabbitmq_mgmt_back

backend rabbitmq_mgmt_back
    balance roundrobin
    server rabbitmq1 rabbitmq1:15672 check inter 5000 rise 2 fall 3
    server rabbitmq2 rabbitmq2:15672 check inter 5000 rise 2 fall 3
    server rabbitmq3 rabbitmq3:15672 check inter 5000 rise 2 fall 3

# Stats page
stats enable
stats uri /stats
stats refresh 30s
